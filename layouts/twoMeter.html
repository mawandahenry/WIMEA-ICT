<div class="ms2">
<table class = "table owk">
  <tr><td>Right connections:</td><td id="rightcon"></td></tr>
<tr><td>wrong connections:</td><td id="wrong"></td></tr>
<tr><td>Percentage:</td><td id="perc"></td></tr>
<tr><td><button class = "btn btn-danger">close</button></td><td></td></tr>
</table>

<button class = "btn btn-primary" style="float: right;" id="award">Check out</button>
</div>


  <script>
  $(function(){

var count = 0;
var counter =[];
    $('#ban').on('click','.opo', function(evt){
      $('.ms2').append("<img id = 'drag"+count+"' src = '"+evt.target.attributes[1].nodeValue+"' width='100' is_main ='"+evt.target.attributes[2].nodeValue+"' height='100' class = 'draggable running '/>");
      count++;
      $( ".draggable" ).draggable({
          start: function(ex) {
              if($(this).hasClass('lastActive')){
                $(this).removeClass('lastActive').addClass('activeNow');
              }
              $(this).addClass('activeNow');

             },

         drag: function(exc) {

           if(exc.target.attributes[3].nodeValue.toString() == "true"){

             exc.target.attributes[2].nodeValue=200;
             exc.target.attributes[4].nodeValue=250;
           }

         },
        stop: function () {
          points = [];
          offsets = [];
           $(this).removeClass('lastActive');
            $(this).removeClass('activeNow');

            $('.main_2m').removeClass('touched');
              $('#boost').removeClass('pointed').addClass('defaulty');
              $('.ms2').on('click', '.running', function(el){
              el.stopImmediatePropagation();
              if(points.length == 0){
                var x = el.pageX;
                var y = el.pageY;
                var x1 = el.pageX - $(this).offset().left;
                var y2 = el.pageY - $(this).offset().top;
                var panza = {x1,y2};
                counter.push(panza);

                var points_ar = {};
                points_ar = {x,y};
                points.push(points_ar);

              }
              else if(points.length ==1){
                var x = el.clientX;
                var y = el.clientY;
                var refre = $(this).offset().left;
                var x1 = el.pageX - $(this).offset().left;
                var y2 = el.pageY - $(this).offset().top;
                var parent = el.target.attributes[0].nodeValue;
                var panza = {x1, y2};
                counter.push(panza);
                var points_ar = {};
                points_ar = {x,y};
                points.push(points_ar);
                points.push(parent);

                connect_images(points[0], points[1], points[2]);
                points.splice(0,points.length);
              }
          })

        }
      })
    });


$('#award').click(function(e){


 $('.ms2').each(function(e){
   var results = [
     'images/sht25.png',
     'images/i2c cable.png',
     'images/S2-PCB-front clear.png',
     'images/Li-ion capacitor2 clear.png',
     'images/DC Boost Converter.png',
     'images/solar panel 0.png'
   ];
   var favs = $(this).find('img');
   var lines = $('[class = drawer]');

   var sum = 0;
   var total = favs.length;
   var pcb_id = null;
   var battery_id = null;
   var panel_id = null;
   var temp_id = null;
   var boost_id = null;

   for (var x = 0; x < total; x++) {
      if(favs[x].attributes[1].nodeValue == results[2]){
        pcb_id = $('#'+favs[x].id)
      }
      else if(favs[x].attributes[1].nodeValue == results[3]){
        battery_id = $('#'+favs[x].id)
      }
      else if(favs[x].attributes[1].nodeValue == results[5]){
        panel_id = $('#'+favs[x].id)
      }
      else if(favs[x].attributes[1].nodeValue == results[0]){
        temp_id = $('#'+favs[x].id)
      }
      else if(favs[x].attributes[1].nodeValue == results[4]){
        boost_id = $('#'+favs[x].id)
      }
   }
console.log(lines.length);
   for (var i = 0; i < lines.length; i++) {
     // console.log(lines[i]);
     // if(colDetect(panel_id, $('#'+lines[i].id)) && colDetect(boost_id, $('#'+lines[i].id)) || colDetect(boost_id, $('#'+lines[i].id)) && colDetect(panel_id, $('#'+lines[i].id)) ){
     //    $('#'+lines[i].id).css({"border":"1px solid green"});
     // }

     console.log(isOverlap(pcb_id, $('#'+lines[i].id)));
        console.log(isOverlap(battery_id, $('#'+lines[i].id)));
       console.log(isOverlap(boost_id, $('#'+lines[i].id)));
        console.log(isOverlap(panel_id, $('#'+lines[i].id)));
          console.log(isOverlap(temp_id, $('#'+lines[i].id)));
      // if( pcb_id != null && isOverlap(pcb_id, $('#'+lines[i].id)) && battery_id != null && colDetect(battery_id, $('#'+lines[i].id))){
      // alert('wow');
      //
      // }
      // else if(pcb_id != null && colDetect(pcb_id, $('#'+lines[i].id)) && temp_id != null && colDetect(temp_id, $('#'+lines[i].id))){
      //   $('#'+lines[i].id).css({"border":"1px solid green"});
      //   // console.log($('#'+lines[i].id).offset());
      // }
      // else if(battery_id != null && colDetect(battery_id, $('#'+lines[i].id)) && boost_id != null && colDetect(boost_id, $('#'+lines[i].id))){
      //   $('#'+lines[i].id).css({"border":"1px solid green"});
      //   // console.log($('#'+lines[i].id).offset());
      // }
      // else if(boost_id != null && colDetect(boost_id, $('#'+lines[i].id)) && panel_id != null && colDetect(panel_id, $('#'+lines[i].id))){
      //   $('#'+lines[i].id).css({"border":"1px solid green"});
      // }
      // else{
      //     $('#'+lines[i].id).css({"border":"1px solid red"});
      // }
   }
   $('#rightcon').text(sum);
  $('#wrong').text(total-sum);
   var  percent = (sum/total)*100;
  $('#perc').text(percent.toFixed(2)+"%");
  percent<50? $('#perc').addClass('poor'):$('#perc').addClass('good')
  $('.owk').show();
 })
})


  });

  </script>
